# orthogonal-table-mit

[![Python](https://img.shields.io/badge/Python-3.10+-blue)](https://www.python.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

Python で **L9直交表** を簡単に作成し、コンジョイント分析や実験計画法で使える形式に変換するパッケージです。

---

## 概要

- `levels.csv` から因子ごとの水準リストを取得
- L9直交表に基づき、各組み合わせを水準値に変換
- 直交表の順番を安定させて DataFrame 化
- コンジョイント分析用に行列を転置して保存
- Windows / Mac / Linux で出力フォルダを自動で開く

💡ポイント  
- 因子と水準の整理を事前に行うことで、分析の意味を損なわず準備できる  
- 回答者の負担を減らしつつ、効率的に実験・アンケート設計が可能

---

## フォルダ構成

```
├─ 1_flow/
│   └─ orthogonal-table.py       # R 実行スクリプト
├─ 2_data/
│   └─ levels.csv                # 水準表　サンプル
├─ 3_output/                     # 決定木出力画像用（自動作成）
```



---

## 入力データフォーマット例

2_data/levels.csv を参照してください。  
**例：3因子水準表**
| OS（ブランド）           | バッテリー   | 画面サイズ |
|--------------------------|------------|------------|
| iPhone                   | 3000mAh    | 5インチ    |
| Android（一般）           | 4500mAh    | 6インチ    |
| Galaxy M51（高バッテリー） | 6500mAh    | 6.8インチ  |

**例：4因子水準表**
| OS（ブランド）           | バッテリー   | 画面サイズ | 価格  |
|--------------------------|------------|------------|-------|
| iPhone                   | 3000mAh    | 5インチ    | 6万   |
| Android（一般）           | 4500mAh    | 6インチ    | 13万  |
| Galaxy M51（高バッテリー） | 6500mAh    | 6.8インチ  | 24万  |

💡ポイント  
- 連続値（例：価格や容量）は丸めてカテゴリ化した水準を使うと、直交表の組み合わせ数を抑えられます  
- カテゴリ化により傾向をつかみやすく、分析結果の解釈や応用がしやすくなります

---

## インストール

```bash
pip install orthogonal-table-mit
```
---
# 使い方
## 1. データ準備

2_data/levels.csv に因子と水準を記載します。

## 2. 実行例
```bash
from orthogonal_table_mit import create_orthogonal_table

create_orthogonal_table(
    input_csv="2_data/levels.csv",
    output_folder="3_output"
)
```
- 実行すると 3_output/直交表.csv が生成されます
- 行列はコンジョイント分析用に転置済みです

## ステップ解説

### 1. データ読み込み
- `levels.csv` を UTF-8 で読み込み、失敗した場合は cp932 に切り替え
- OS に依存せず安定して読み込めます

### 2. 因子ごとのユニーク水準リスト作成
- 欠損値を除外してユニーク値を抽出
- 各因子の水準を `factor_levels` に辞書形式で格納

### 3. L9直交表のインデックス選択
- 因子数に応じて 3因子または4因子用の L9 インデックスを使用
- インデックスは 0始まりで、水準リストの位置を指す
- 各行は 1 回の実験条件の組み合わせ

### 4. 直交表作成（インデックス → 水準値）
- L9 インデックスを水準値に置き換えて DataFrame 化
- 列名は元の因子名を使用
- 各行が 1 回の実験条件の組み合わせとなる

### 5. コンジョイント分析用に行列転置
- 作成した直交表を転置して、分析で扱いやすい形式に整形
- CSV に保存して再利用可能

### 6. 因子順の安定化
- 選択した因子に対応する水準リストを因子順に揃える
- 組み合わせの整合性を保持

### 注意事項
- 回帰で使用する `area_` 列は **CSV 内の列順に従って固定**  
- 列の順序を変えると結果も変わる可能性があります  
- 再現性を保つため、CSV の列順は変更しないでください

---
## まとめ
- 「どんな調査をしたいのか」「何を目的に分析するのか」を明確にしてから直交表を作成
- 目的が不明確だと水準表がブレてしまい、調査や分析の意味が薄れる
- 直交表作成前に 目的をクリアにする ことが重要
---

## 今後の拡張予定
- CSV・Excel など多様な入力形式への対応
- 転置や保存形式の柔軟化
- より複雑な因子構成や水準数にも対応
---
### 精度・機能の向上
- 自動直交表生成アルゴリズムの追加
- CSVやExcelなど多様な入力形式への対応
- 転置や保存形式の柔軟化
---
### 分析対象の拡張
- 3因子以上の直交表自動生成
- 実験計画法の他の標準直交表への対応
- 将来的にはコンジョイント分析以外の実験計画への応用も検討

---

## 貢献方法

プロジェクトへの貢献は以下の方法で歓迎します：

- バグ報告や機能追加の提案は [Issues](https://github.com/iwakazusuwa/orthogonal-table-mit/issues) から
- コード改善や新機能追加は Pull Request を作成
- ドキュメントの改善やサンプル追加も歓迎


## LICENSE
MIT License（詳細はLICENSEファイルをご参照ください）

#### 開発者： iwakazusuwa(Swatchp)





